import requests
import streamlit as st

# å®šä¹‰æœ¬åœ°èŠå¤©æœºå™¨äººåç«¯çš„æ¥å£åœ°å€
LOCAL_API_URL = "http://221.236.30.69:5200/chat"

st.set_page_config(page_title="Vulnerability Detector", page_icon="ğŸ¤–", )

with st.sidebar:
    # ä¸å†éœ€è¦è¾“å…¥ OpenAI API å¯†é’¥
    st.info("Welcome to our Vulnerability Detector")

    st.markdown("<h1 style='text-align: center;'>å¦‚ä½•å¼€å§‹ âŒ¨ï¸</h1>", unsafe_allow_html=True)
    st.markdown(
        "  è¿™æ˜¯åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æºä»£ç æ¼æ´æŒ–æ˜æ£€æµ‹ç³»ç»Ÿ. ğŸ†ğŸ†"
    )
    st.markdown(
        "  ä½ å¯ä»¥é—®å¥¹è®¸å¤šå…³äºæºä»£ç æ¼æ´çš„é—®é¢˜ã€‚"
    )
    st.markdown(
        "  æœ¬ç³»ç»Ÿä»åœ¨ä¸æ–­ç²¾è¿›å®Œå–„ä¸­â€¦â€¦ "
    )

st.title("ğŸ—£ï¸ Vulnerability Detector")
st.caption("ğŸ‘¨ğŸ»â€ğŸ’» A Vulnerability Detector powered by a local sever")


if "messages" not in st.session_state:
    st.session_state["messages"] = [{"role": "assistant", "content": "How can I help you?"}]

for msg in st.session_state.messages:
    st.chat_message(msg["role"]).write(msg["content"])

if user_input := st.chat_input():
    # æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
    st.session_state.messages.append({"role": "user", "content": user_input})
    st.chat_message("user").write(user_input)
    # å‘é€è¯·æ±‚åˆ°æœ¬åœ°èŠå¤©æœºå™¨äººåç«¯æ¥å£
    response = requests.post(LOCAL_API_URL, json={"user_input": user_input})
    if response.status_code == 200:
        msg = response.json()["reply"]
        st.session_state.messages.append({"role": "assistant", "content": msg})
        st.chat_message("assistant").write(msg)
    else:
        st.error("Failed to get response from the local backend.\nSomething went wrong")


